@model MovieStoreMvc.Models.Ticket

@{
    ViewData["Title"] = "Create";
}

<h1>Create</h1>

<h4>Ticket</h4>
<hr />
<div class="row">
    <div class="col-md-4">
        <form asp-action="Create">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <div class="form-group">
                <label class="control-label">Room</label>
                <select class="form-control" id="room" name="room" asp-items="ViewBag.Room">
                    <option value="" hidden>-- Chọn Room --</option>
                </select>
            </div>

            <div class="form-group d-none" id="seat-block">
                <label class="control-label">Seat</label>
                <select class="form-control" id="seat" name="seat">
                    <option value="" hidden>-- Chọn Seat --</option>
                </select>
            </div>

            @* <div class="form-group">
                <label asp-for="ShowtimesId" class="control-label"></label>
                <select asp-for="ShowtimesId" class="form-control" asp-items="ViewBag.ShowtimesId"></select>
            </div> *@

            <div class="form-group">
                <label class="control-label">Ngày</label>
                <select class="form-control" id="date" name="date" asp-items="ViewBag.Date">
                    <option value="" hidden>-- Chọn ngày --</option>
                </select>
            </div>

            <div class="form-group d-none" id="time-block">
                <label class="control-label">Giờ</label>
                <select class="form-control" id="time" name="time">
                    <option value="" hidden>-- Chọn Giờ --</option>
                </select>
            </div>

            <div class="form-group">
                <label asp-for="Description" class="control-label"></label>
                <input asp-for="Description" class="form-control" />
                <span asp-validation-for="Description" class="text-danger"></span>
            </div>

            <div class="form-group">
                <input type="submit" value="Create" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        $(document).ready(function () {
            $("#room").on("change", function () {
                var roomId = $('#room').val();
                $("#seat-block").removeClass("d-none");

                $.ajax({
                    type: 'GET',
                    // dataType: "json",
                    url: 'GetSeats?roomId=' + roomId,
                    success: function (data, status, xhr) {
                        
                        $("option.seat-option").remove();
                        $.each(data, function (index, value) {
                            $("#seat").append('<option class="seat-option"' + 'value="' + value + '">' + value + '</option>');
                        });
                    }
                });
            });

            $("#date").on("change", function () {
                var date = $('#date').val();
                $("#time-block").removeClass("d-none");

                $.ajax({
                    type: 'GET',
                    url: 'GetTimes?date=' + date,
                    success: function (data, status, xhr) {

                        $("option.time-option").remove();
                        $.each(data, function (index, value) {
                            $("#time").append('<option class="time-option"' + 'value="' + value + '">' + value + '</option>');
                        });
                    }
                });
            });


        });

    </script>

}
